<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Schema - H·ªá th·ªëng ChƒÉm s√≥c Ng∆∞·ªùi cao tu·ªïi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .diagram-container {
            position: relative;
            width: 100%;
            height: 800px;
            background: #f7fafc;
            border-radius: 8px;
            overflow: auto;
            border: 2px solid #e2e8f0;
        }

        .canvas {
            position: relative;
            width: 1600px;
            height: 1200px;
            margin: 20px;
        }

        .table {
            position: absolute;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            min-width: 280px;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: move;
        }

        .table:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .table-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 16px;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .table-icon {
            font-size: 20px;
        }

        .table-body {
            padding: 0;
        }

        .field {
            padding: 10px 16px;
            border-bottom: 1px solid #e2e8f0;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .field:last-child {
            border-bottom: none;
        }

        .field-name {
            font-weight: 600;
            color: #2d3748;
            flex: 1;
        }

        .field-type {
            color: #718096;
            font-size: 11px;
            background: #edf2f7;
            padding: 2px 8px;
            border-radius: 4px;
        }

        .field-note {
            color: #a0aec0;
            font-size: 11px;
            font-style: italic;
            margin-top: 2px;
            display: block;
        }

        .pk {
            color: #f6ad55;
            font-weight: bold;
            font-size: 10px;
        }

        .fk {
            color: #9f7aea;
            font-weight: bold;
            font-size: 10px;
        }

        .relationship {
            position: absolute;
            pointer-events: none;
        }

        .relationship-line {
            stroke: #cbd5e0;
            stroke-width: 2;
            fill: none;
        }

        .relationship-label {
            position: absolute;
            background: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            color: #4a5568;
            border: 1px solid #e2e8f0;
            white-space: nowrap;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .cardinality {
            font-size: 14px;
            font-weight: bold;
            color: #667eea;
        }

        .legend {
            margin-top: 20px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .legend-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2d3748;
        }

        .legend-items {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .table {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè• H·ªá th·ªëng ChƒÉm s√≥c Ng∆∞·ªùi cao tu·ªïi</h1>
        <p class="subtitle">Database Schema - Elderly Care Companion System</p>
        
        <div class="diagram-container">
            <svg class="canvas" id="canvas">
                <!-- Tables will be positioned here -->
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                        <polygon points="0 0, 10 3, 0 6" fill="#cbd5e0" />
                    </marker>
                </defs>
                
                <!-- Relationships will be drawn here -->
                <g id="relationships"></g>
            </svg>
            
            <!-- Tables -->
            <div class="table" id="users" style="left: 50px; top: 50px;">
                <div class="table-header">
                    <span class="table-icon">üë§</span>
                    <span>USERS</span>
                </div>
                <div class="table-body">
                    <div class="field">
                        <span class="field-name">id</span>
                        <span class="pk">PK</span>
                        <span class="field-type">uuid</span>
                    </div>
                    <div class="field">
                        <span class="field-name">full_name</span>
                        <span class="field-type">string</span>
                    </div>
                    <div class="field">
                        <span class="field-name">nickname</span>
                        <span class="field-type">string</span>
                        <span class="field-note">T√™n g·ªçi th√¢n m·∫≠t</span>
                    </div>
                    <div class="field">
                        <span class="field-name">dob</span>
                        <span class="field-type">date</span>
                    </div>
                    <div class="field">
                        <span class="field-name">phone</span>
                        <span class="field-type">string</span>
                    </div>
                    <div class="field">
                        <span class="field-name">emergency_contact</span>
                        <span class="field-type">string</span>
                        <span class="field-note">SƒêT ng∆∞·ªùi th√¢n</span>
                    </div>
                    <div class="field">
                        <span class="field-name">created_at</span>
                        <span class="field-type">timestamp</span>
                    </div>
                </div>
            </div>

            <div class="table" id="user_profiles" style="left: 450px; top: 50px;">
                <div class="table-header">
                    <span class="table-icon">üìã</span>
                    <span>USER_PROFILES</span>
                </div>
                <div class="table-body">
                    <div class="field">
                        <span class="field-name">user_id</span>
                        <span class="fk">FK</span>
                        <span class="field-type">uuid</span>
                    </div>
                    <div class="field">
                        <span class="field-name">health_condition</span>
                        <span class="field-type">text</span>
                        <span class="field-note">T√¨nh tr·∫°ng s·ª©c kh·ªèe</span>
                    </div>
                    <div class="field">
                        <span class="field-name">daily_routine</span>
                        <span class="field-type">jsonb</span>
                        <span class="field-note">L·ªãch tr√¨nh sinh ho·∫°t</span>
                    </div>
                    <div class="field">
                        <span class="field-name">interests</span>
                        <span class="field-type">text[]</span>
                        <span class="field-note">S·ªü th√≠ch</span>
                    </div>
                    <div class="field">
                        <span class="field-name">biographical_notes</span>
                        <span class="field-type">text</span>
                        <span class="field-note">Ti·ªÉu s·ª≠/K·ª∑ ni·ªám</span>
                    </div>
                </div>
            </div>

            <div class="table" id="agents" style="left: 50px; top: 350px;">
                <div class="table-header">
                    <span class="table-icon">ü§ñ</span>
                    <span>AGENTS</span>
                </div>
                <div class="table-body">
                    <div class="field">
                        <span class="field-name">id</span>
                        <span class="pk">PK</span>
                        <span class="field-type">uuid</span>
                    </div>
                    <div class="field">
                        <span class="field-name">user_id</span>
                        <span class="fk">FK</span>
                        <span class="field-type">uuid</span>
                    </div>
                    <div class="field">
                        <span class="field-name">name</span>
                        <span class="field-type">string</span>
                    </div>
                    <div class="field">
                        <span class="field-name">persona_type</span>
                        <span class="field-type">string</span>
                        <span class="field-note">Companion/Caregiver</span>
                    </div>
                    <div class="field">
                        <span class="field-name">relationship_role</span>
                        <span class="field-type">string</span>
                        <span class="field-note">Ch√°u/B·∫°n gi√†/Y t√°</span>
                    </div>
                    <div class="field">
                        <span class="field-name">voice_id</span>
                        <span class="field-type">string</span>
                    </div>
                    <div class="field">
                        <span class="field-name">avatar_url</span>
                        <span class="field-type">string</span>
                    </div>
                </div>
            </div>

            <div class="table" id="memories" style="left: 450px; top: 350px;">
                <div class="table-header">
                    <span class="table-icon">üß†</span>
                    <span>MEMORIES</span>
                </div>
                <div class="table-body">
                    <div class="field">
                        <span class="field-name">id</span>
                        <span class="pk">PK</span>
                        <span class="field-type">uuid</span>
                    </div>
                    <div class="field">
                        <span class="field-name">user_id</span>
                        <span class="fk">FK</span>
                        <span class="field-type">uuid</span>
                    </div>
                    <div class="field">
                        <span class="field-name">embedding</span>
                        <span class="field-type">vector</span>
                        <span class="field-note">Vector h√≥a n·ªôi dung</span>
                    </div>
                    <div class="field">
                        <span class="field-name">content</span>
                        <span class="field-type">text</span>
                        <span class="field-note">M·∫©u th√¥ng tin ghi nh·ªõ</span>
                    </div>
                    <div class="field">
                        <span class="field-name">importance</span>
                        <span class="field-type">int</span>
                        <span class="field-note">ƒê·ªô quan tr·ªçng (1-5)</span>
                    </div>
                    <div class="field">
                        <span class="field-name">created_at</span>
                        <span class="field-type">timestamp</span>
                    </div>
                </div>
            </div>

            <div class="table" id="conversations" style="left: 50px; top: 700px;">
                <div class="table-header">
                    <span class="table-icon">üí¨</span>
                    <span>CONVERSATIONS</span>
                </div>
                <div class="table-body">
                    <div class="field">
                        <span class="field-name">id</span>
                        <span class="pk">PK</span>
                        <span class="field-type">uuid</span>
                    </div>
                    <div class="field">
                        <span class="field-name">agent_id</span>
                        <span class="fk">FK</span>
                        <span class="field-type">uuid</span>
                    </div>
                    <div class="field">
                        <span class="field-name">started_at</span>
                        <span class="field-type">timestamp</span>
                    </div>
                    <div class="field">
                        <span class="field-name">summary</span>
                        <span class="field-type">string</span>
                        <span class="field-note">T√≥m t·∫Øt phi√™n chat</span>
                    </div>
                </div>
            </div>

            <div class="table" id="messages" style="left: 450px; top: 700px;">
                <div class="table-header">
                    <span class="table-icon">‚úâÔ∏è</span>
                    <span>MESSAGES</span>
                </div>
                <div class="table-body">
                    <div class="field">
                        <span class="field-name">id</span>
                        <span class="pk">PK</span>
                        <span class="field-type">uuid</span>
                    </div>
                    <div class="field">
                        <span class="field-name">conversation_id</span>
                        <span class="fk">FK</span>
                        <span class="field-type">uuid</span>
                    </div>
                    <div class="field">
                        <span class="field-name">role</span>
                        <span class="field-type">string</span>
                        <span class="field-note">user/assistant</span>
                    </div>
                    <div class="field">
                        <span class="field-name">content</span>
                        <span class="field-type">text</span>
                    </div>
                    <div class="field">
                        <span class="field-name">emotion</span>
                        <span class="field-type">string</span>
                        <span class="field-note">Vui/bu·ªìn/lo l·∫Øng</span>
                    </div>
                    <div class="field">
                        <span class="field-name">created_at</span>
                        <span class="field-type">timestamp</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="legend">
            <div class="legend-title">üìñ Ch√∫ th√≠ch / Legend</div>
            <div class="legend-items">
                <div class="legend-item">
                    <span class="pk">PK</span>
                    <span>Primary Key (Kh√≥a ch√≠nh)</span>
                </div>
                <div class="legend-item">
                    <span class="fk">FK</span>
                    <span>Foreign Key (Kh√≥a ngo·∫°i)</span>
                </div>
                <div class="legend-item">
                    <span class="cardinality">||--o1</span>
                    <span>One-to-One (1-1)</span>
                </div>
                <div class="legend-item">
                    <span class="cardinality">||--oN</span>
                    <span>One-to-Many (1-N)</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Draw relationships between tables
        function drawRelationships() {
            const svg = document.getElementById('relationships');
            const relationships = [
                { from: 'users', to: 'user_profiles', label: 'has', type: '1:1' },
                { from: 'users', to: 'agents', label: 'interacts_with', type: '1:N' },
                { from: 'users', to: 'memories', label: 'owned_by', type: '1:N' },
                { from: 'agents', to: 'conversations', label: 'participates', type: '1:N' },
                { from: 'conversations', to: 'messages', label: 'contains', type: '1:N' }
            ];

            relationships.forEach(rel => {
                const fromEl = document.getElementById(rel.from);
                const toEl = document.getElementById(rel.to);
                
                const fromRect = fromEl.getBoundingClientRect();
                const toRect = toEl.getBoundingClientRect();
                const containerRect = document.querySelector('.canvas').getBoundingClientRect();

                const fromX = fromRect.right - containerRect.left;
                const fromY = fromRect.top - containerRect.top + fromRect.height / 2;
                const toX = toRect.left - containerRect.left;
                const toY = toRect.top - containerRect.top + toRect.height / 2;

                const line = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                const midX = (fromX + toX) / 2;
                const d = `M ${fromX} ${fromY} Q ${midX} ${fromY}, ${midX} ${(fromY + toY) / 2} T ${toX} ${toY}`;
                
                line.setAttribute('d', d);
                line.setAttribute('class', 'relationship-line');
                line.setAttribute('marker-end', 'url(#arrowhead)');
                svg.appendChild(line);

                // Add label
                const labelDiv = document.createElement('div');
                labelDiv.className = 'relationship-label';
                labelDiv.textContent = `${rel.label} (${rel.type})`;
                labelDiv.style.left = `${midX - 40}px`;
                labelDiv.style.top = `${(fromY + toY) / 2 - 12}px`;
                document.querySelector('.canvas').appendChild(labelDiv);
            });
        }

        // Initialize
        window.addEventListener('load', () => {
            setTimeout(drawRelationships, 100);
        });

        // Redraw on window resize
        window.addEventListener('resize', () => {
            const svg = document.getElementById('relationships');
            svg.innerHTML = '';
            document.querySelectorAll('.relationship-label').forEach(el => el.remove());
            drawRelationships();
        });
    </script>
</body>
</html>
